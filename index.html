<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>AI vs AI Chess</title>

<style>
  body { background:#111; color:#eee; font-family:Arial; }

  #board {
    width: 480px;
    height: 480px;
    display: grid;
    grid-template-columns: repeat(8, 1fr);
    grid-template-rows: repeat(8, 1fr);
    border: 3px solid #444;
    margin-top:20px;
  }

  .sq {
    display:flex;
    align-items:center;
    justify-content:center;
    font-size:38px;
  }

  .dark { background:#555; }
  .light { background:#ccc; color:#000; }

  #debugPanel {
    position:fixed;
    right:0;top:0;bottom:0;
    width:350px;
    background:#222;
    color:#0f0;
    padding:10px;
    overflow-y:auto;
    display:none;
    border-left:2px solid #555;
  }
</style>

<script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/1.0.0/chess.min.js"></script>
</head>
<body>

<h2>GPT-4o-mini vs GPT-4o-mini</h2>
<div id="board"></div>
<div id="debugPanel"></div>

<script>
const KEY_WHITE = "YOUR_FIRST_API_KEY";
const KEY_BLACK = "YOUR_SECOND_API_KEY";
const MODEL = "gpt-4o-mini";
const MOVE_DELAY = 1000;

let chess;
let debugVisible = false;

function createBoard() {
  let boardDiv = document.getElementById("board");
  boardDiv.innerHTML = "";
  let squares = chess.board();

  for (let r = 0; r < 8; r++) {
    for (let c = 0; c < 8; c++) {
      let sq = document.createElement("div");
      sq.classList.add("sq");
      sq.classList.add((r + c) % 2 === 0 ? "light" : "dark");

      let piece = squares[r][c];
      if (piece) {
        let icon = {
          p:"♟", n:"♞", b:"♝", r:"♜", q:"♛", k:"♚"
        }[piece.type];
        sq.textContent = piece.color === "w" ? icon.toUpperCase() : icon;
      }

      boardDiv.appendChild(sq);
    }
  }
}

function logDebug(t) {
  let d = document.createElement("div");
  d.textContent = t;
  document.getElementById("debugPanel").appendChild(d);
}

document.addEventListener("keydown",(e)=>{
  if(e.key.toLowerCase()==="f"){
    debugVisible = !debugVisible;
    document.getElementById("debugPanel").style.display =
      debugVisible ? "block" : "none";
  }
});

async function askModel(apiKey, fen, hist) {
  const prompt = `
You are playing chess. Give only one legal SAN move.
FEN: ${fen}
Moves: ${hist.join(", ")}
Move:
`.trim();

  logDebug("PROMPT → " + prompt);

  let r = await fetch("https://api.openai.com/v1/chat/completions", {
    method:"POST",
    headers:{
      "Authorization":"Bearer "+apiKey,
      "Content-Type":"application/json"
    },
    body:JSON.stringify({
      model:MODEL,
      messages:[{role:"user",content:prompt}],
      max_tokens:20
    })
  });

  let data = await r.json();
  let mv = data?.choices?.[0]?.message?.content?.trim();
  logDebug("RESPONSE ← " + mv);
  return mv;
}

async function play() {
  if (chess.game_over()) return logDebug("GAME OVER");

  let api = chess.turn()==="w" ? KEY_WHITE : KEY_BLACK;
  let move = await askModel(api, chess.fen(), chess.history());

  try {
    chess.move(move);
  } catch {
    logDebug("INVALID MOVE, retrying: "+move);
    return setTimeout(play, MOVE_DELAY);
  }

  createBoard();
  setTimeout(play, MOVE_DELAY);
}

window.onload = () => {
  chess = new Chess();
  createBoard();
  play();
};
</script>

</body>
</html>
